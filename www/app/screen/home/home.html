<div ng-controller="homeController">
  <section ng-style="{'margin-bottom': $root.currentStepHeight + 'px'}" class="row">
    <div current-step class="current-step">
      <div class="col-lg-12 col-md-12 col-sm-12">
        <ul class="nav nav-tabs">
          <li class="active" ng-repeat="step in home.currentSteps | orderBy: 'wait'"><a>{{$index + 1}}</a></li>
        </ul>
        <div class="description row">
          <div class="col-lg-{{12/home.currentSteps.length}} col-md-{{12/home.currentSteps.length}} col-sm-{{12/home.currentSteps.length}}" ng-repeat="step in home.currentSteps | orderBy: 'wait'">
            <p><strong>{{$root.data[step.recipe].name}}</strong><span class="badge pull-right">step {{step.number + 1}}</span></p>
            <ul>
              <li>duration: {{step.duration}} min</li>
              <li>time: {{home.formatTime(step.startTime) | date:'hh:mm a'}} - {{home.formatTime(step.finishTime) | date:'hh:mm a'}}</li>
              <li>parallel: {{{true: 'yes', false: 'no'}[step.parallel]}}</li>
              <li ng-if="step.overlap">overlap: <span ng-repeat="overlap in step.overlap">{{overlap + 1}}</span></li>
              <li ng-if="step.precede">precede: {{step.precede + 1}}</li>
            </ul>
            <p>{{step.description}}</p>
          </div>
        </div>
      </div>
    </div>
    <header class="col-lg-12 col-md-12 col-sm-12">
      <h1>Recipe Merger</h1>
      <button ng-if="home.menu.length == 0" ng-click="home.merge()">Merge</button>
      <button ng-if="home.menu.length > 0" ng-click="home.menu = []">Unmerge</button>
      <div class="time-picker" uib-timepicker ng-model="home.elapsedTime" ng-change="home.moveTimeMarker()" hour-step="1" minute-step="1" show-meridian="true" show-spinners="false" pad-hours="false"></div>
    </header>
    <div ng-if="home.menu.length > 0" ng-style="{'bottom': home.elapsedTimePosition * home.height + 'px'}" class="time-marker">
      <span>{{home.elapsedTime | date: 'h:mm a'}}</span>
    </div>
    <div ng-style="{'width': 100/$root.data.length + '%'}" class="col-lg-12 col-md-12 col-sm-12 recipe" ng-if="recipe.name.length > 0" ng-repeat="recipe in $root.data track by $index">
      <h4>{{recipe.name}}</h4>
      <div uib-timepicker ng-model="recipe.finishTime" ng-change="home.merge()" hour-step="1" minute-step="5" show-meridian="true" show-spinners="false" pad-hours="false"></div>
      <div class="method">
        <div ng-if="home.menu.length == 0" ng-style="{'height': step.duration * home.height + 'px'}" class="step unmerged" ng-repeat="step in recipe.steps">
          <span>#{{$index + 1}} - {{step.duration}} min</span>
          <i class="fa fa-clock-o" ng-if="step.parallel"></i>
        </div>
        <div ng-if="home.menu.length > 0" ng-style="{'height': home.recipeLength * home.height + 'px'}">
          <div ng-style="{'height': step.duration * home.height + 'px', 'top': (home.recipeLength - step.offset - step.duration) * home.height + 'px'}" class="step {{home.stepClass(step)}}" ng-if="step.recipe == $parent.$index" uib-tooltip="#{{step.number + 1}} - {{step.duration}} min" ng-repeat="step in home.menu | orderBy: 'startTime'"></div>
        </div>
      </div>
    </div>
  </section>
  <footer>footer</footer>
</div>
